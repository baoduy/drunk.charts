# All-in-One Configuration
# Install Gateway API resources with cert-manager in a single command
#
# This example demonstrates installing everything together:
# - GatewayClass
# - Gateway for drunk.dev domain
# - cert-manager (as dependency)
# - ClusterIssuer for Let's Encrypt

# Install cert-manager as a dependency
certManager:
  install: true
  installCRDs: true

  # Create ClusterIssuers for automatic TLS
  enabled: true
  clusterIssuers:
    - name: letsencrypt-prod
      email: admin@drunk.dev # Change to your email
      server: https://acme-v02.api.letsencrypt.org/directory
      privateKeySecretRef:
        name: letsencrypt-prod-key
      solvers:
        - http01:
            gatewayHTTPRoute:
              parentRefs:
                - kind: Gateway
                  name: drunk-dev-gateway
                  namespace: default

gatewayClass:
  enabled: true
  name: nginx
  controllerName: gateway.nginx.org/nginx-gateway-controller

domains:
  - name: drunk-dev
    enabled: true
    gatewayClassName: nginx
    annotations:
      # cert-manager will automatically create and manage certificates
      cert-manager.io/cluster-issuer: letsencrypt-prod
    listeners:
      - name: http
        protocol: HTTP
        port: 80
        hostname: "*.drunk.dev"
        allowedRoutes:
          namespaces:
            from: Same
      - name: https
        protocol: HTTPS
        port: 443
        hostname: "*.drunk.dev"
        tls:
          mode: Terminate
          certificateRefs:
            - kind: Secret
              name: drunk-dev-tls # cert-manager creates this automatically
        allowedRoutes:
          namespaces:
            from: Same
# Usage:
# helm install gateway . -f examples/all-in-one.yaml -n default --create-namespace
#
# This single command will:
# 1. Install cert-manager with CRDs
# 2. Create GatewayClass
# 3. Create Gateway for *.drunk.dev
# 4. Create Let's Encrypt ClusterIssuer
# 5. Automatically provision TLS certificates
